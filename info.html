<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Irra Store</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            line-height: 1.6;
        }

        .registration-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            margin-bottom: 10px;
        }

        .btn:hover {
            background-color: #45a049;
        }

        .status-message {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
        }

        .status-message.success {
            background-color: #dff0d8;
            color: #3c763d;
        }

        .status-message.error {
            background-color: #f2dede;
            color: #a94442;
        }

        h1 {
            text-align: center;
            color: #4CAF50;
            margin-bottom: 20px;
        }

        .instructions {
            font-size: 0.8em;
            color: #666;
            text-align: center;
            margin-bottom: 15px;
        }

        .invoice {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="registration-container">
        <h1>Irra Store</h1>
        <div class="instructions">
            Enter your Telegram username, skin name, and select the price.
        </div>
        <form id="registrationForm">
            <!-- Telegram Username Input -->
            <div class="form-group">
                <label for="telegramUsername">Telegram Username</label>
                <input type="text" id="telegramUsername" name="telegramUsername" required placeholder="Enter your Telegram username" minlength="3" maxlength="50">
            </div>

            <!-- Skin Name Input -->
            <div class="form-group">
                <label for="skinName">Skin Name</label>
                <input type="text" id="skinName" name="skinName" required placeholder="Enter the skin name" minlength="3" maxlength="50">
            </div>

            <!-- Price Dropdown -->
            <div class="form-group">
                <label for="price">Select Price</label>
                <select id="price" name="price" required>
                    <option value="1">Price: $1</option>
                    <option value="3">Promotion Price: $3</option>
                </select>
            </div>

            <!-- Show Invoice Button -->
            <button type="button" class="btn" id="showInvoiceBtn">Show Invoice</button>

            <!-- Invoice Section -->
            <div id="invoiceSection" class="invoice" style="display:none;">
                <h2>Invoice Details</h2>
                <p><strong>Telegram Username:</strong> <span id="invoiceTelegramUsername"></span></p>
                <p><strong>Skin Name:</strong> <span id="invoiceSkinName"></span></p>
                <p><strong>Price Selected:</strong> $<span id="invoicePrice"></span></p>
                
                <!-- Pay Button -->
                <button type="button" class="btn" id="payBtn" style="display:none;">Pay</button>
            </div>

            <div id="statusMessage" class="status-message" style="display:none;"></div>
        </form>
    </div>

    <script>
        document.getElementById('showInvoiceBtn').addEventListener('click', function() {
            const telegramUsername = document.getElementById('telegramUsername').value;
            const skinName = document.getElementById('skinName').value;
            const price = document.getElementById('price').value;

            // Ensure all fields are filled out before showing invoice
            if (!telegramUsername || !skinName || !price) {
                alert("Please fill in all the fields.");
                return;
            }

            // Display the invoice details
            document.getElementById('invoiceTelegramUsername').textContent = telegramUsername;
            document.getElementById('invoiceSkinName').textContent = skinName;
            document.getElementById('invoicePrice').textContent = price;

            // Show the invoice section and the Pay button
            document.getElementById('invoiceSection').style.display = 'block';
            document.getElementById('payBtn').style.display = 'block';
        });

        document.getElementById('payBtn').addEventListener('click', async function() {
            const telegramUsername = document.getElementById('telegramUsername').value;
            const skinName = document.getElementById('skinName').value;
            const price = document.getElementById('price').value;

            // Your Telegram Bot Token (IMPORTANT: Replace with your actual bot token)
            const BOT_TOKEN = '7950204890:AAHXGCh_WliNYd2TlnCScO_92EL0_QBkX7Y';
            
            // Your Telegram Chat ID (IMPORTANT: Replace with your actual chat ID)
            const CHAT_ID = '5007619095';
            
            // Prepare the message to send to Telegram
            const message = `New Registration:\n` +
                            `Telegram Username: ${telegramUsername}\n` +
                            `Skin Name: ${skinName}\n` +
                            `Price Selected: $${price}\n` +
                            `Timestamp: ${new Date().toISOString()}`;

            // Status message element
            const statusMessage = document.getElementById('statusMessage');

            try {
                // Send the message to Telegram using Telegram Bot API
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        chat_id: CHAT_ID,
                        text: message
                    })
                });

                // Check if the request was successful
                if (response.ok) {
                    statusMessage.textContent = 'សូមបង់ប្រាក់ជាមុនសិន';
                    statusMessage.className = 'status-message success';
                    statusMessage.style.display = 'block';
                    
                    // Redirect based on selected price
                    let paymentPageUrl = '';
                    if (price === '1') {
                        paymentPageUrl = '1$.html';  // URL for price $1
                    } else if (price === '3') {
                        paymentPageUrl = '1.5$.html';  // URL for price $3
                    }

                    // Redirect to payment page
                    window.location.href = paymentPageUrl;

                } else {
                    throw new Error('Failed to send registration');
                }
            } catch (error) {
                statusMessage.textContent = 'Payment or registration failed. Please try again.';
                statusMessage.className = 'status-message error';
                statusMessage.style.display = 'block';
                console.error('Error:', error);
            }
        });
    </script>
</body>
</html>
