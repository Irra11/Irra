<!DOCTYPE html>
<html lang="km">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Irra Esign</title>
     <link rel="icon" href="https://i.pinimg.com/736x/da/83/78/da8378a6ddba21823631bd644bee4266.jpg"
    
    <!-- Icons & Fonts -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hanuman:wght@400;700&family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        :root{--primary-blue:#0072b5;--primary-cyan:#00bcd4;--bg-color:#f8f9fb;--text-main:#2d3748;--text-muted:#718096}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Inter','Hanuman',sans-serif}
        body{background-color:var(--bg-color);background-image:radial-gradient(#d1d5db .8px,transparent .8px);background-size:24px 24px;color:var(--text-main);min-height:100vh;display:flex;flex-direction:column;padding-top:75px}
        
        /* Navbar */
        .navbar{position:fixed;top:0;left:0;right:0;height:70px;display:flex;justify-content:center;align-items:center;padding:0 15px;background:rgba(255,255,255,.85);backdrop-filter:blur(15px);-webkit-backdrop-filter:blur(15px);z-index:1000;border-bottom:1px solid rgba(0,0,0,.05)}
        .nav-logo{font-weight:800;font-size:1.4rem;color:var(--primary-blue);}
        .menu-toggle{position:absolute;left:15px;font-size:22px;color:var(--primary-blue);cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center}
        
        /* Menu */
        .side-menu{position:fixed;top:0;left:-280px;width:280px;height:100%;background:rgba(255,255,255,.98);backdrop-filter:blur(20px);z-index:2000;transition:.4s cubic-bezier(.4,0,.2,1);box-shadow:10px 0 30px rgba(0,0,0,0.05);padding:30px 20px}
        .side-menu.active{left:0}
        .menu-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.3);z-index:1999;display:none}
        .menu-overlay.active{display:block}
        .menu-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}
        .menu-list{border:1px solid #e2e8f0;border-radius:18px;overflow:hidden;background:#fff}
        .menu-item{padding:16px 20px;display:flex;align-items:center;gap:15px;text-decoration:none;color:var(--text-main);font-weight:600;transition:.2s;cursor:pointer;border-bottom:1px solid #f1f5f9}
        .menu-item:last-child{border-bottom:none}
        .menu-item:active{background:#f8fafc}
        
        /* Container */
        .container{flex:1;display:flex;justify-content:center;align-items:center;padding:20px}
        .card{background:#fff;width:100%;max-width:480px;border-radius:35px;padding:40px 30px;box-shadow:0 15px 45px rgba(0,0,0,.05);border:1px solid #fff;position:relative;text-align:center}
        .card::before{content:'';position:absolute;top:0;left:0;right:0;height:8px;background:var(--primary-blue);border-radius:35px 35px 0 0}
        
        /* Product */
        .product-icon{width:90px;height:90px;background:linear-gradient(135deg,#0072b5 0%,#00bcd4 100%);border-radius:50%;margin:0 auto 20px;display:flex;align-items:center;justify-content:center;border:4px solid #fff;box-shadow:0 10px 25px rgba(0,114,181,.2);overflow:hidden}
        .logo-img{width:100%;height:100%;object-fit:cover}
        .amount-box{display:flex;justify-content:space-between;align-items:center;background:#f4f7f9;border-radius:18px;padding:15px 25px;border:1px solid #edf2f7;margin-bottom:25px}
        .old-price{text-decoration:line-through;color:#ff2d0c;font-size:16px;margin-right:8px}
        .amount-value{font-size:28px;font-weight:800;color:#005a92}
        
        /* Inputs */
        .input-field{width:100%;padding:16px 15px 16px 45px;border-radius:15px;border:1.5px solid #edf2f7;outline:0;transition:.3s;font-size:15px;background:#fff}
        .input-field:focus{border-color:var(--primary-cyan);box-shadow:0 0 0 3px rgba(0,188,212,.1)}
        .terminal{background:#1a202c;border-radius:15px;padding:15px;text-align:left;margin-bottom:25px;border:1px solid #2d3748}
        .btn-get-udid{display:flex;align-items:center;justify-content:center;gap:10px;background:#f8fafc;color:var(--primary-blue);text-decoration:none;padding:14px;border-radius:12px;font-size:13px;font-weight:700;margin-bottom:25px;border:1px dashed var(--primary-blue);transition:.3s}
        .btn-get-udid:active{background:#e2e8f0;transform:scale(.98)}
        .terms-box{display:flex;gap:12px;align-items:flex-start;text-align:left;font-size:13px;color:#718096;margin-bottom:30px;cursor:pointer;user-select:none}
        
        /* Buttons */
        .btn-pay{width:100%;background:linear-gradient(to right,#0072b5,#00bcd4);color:#fff;padding:18px;border:none;border-radius:15px;font-size:16px;font-weight:800;cursor:pointer;opacity:.5;pointer-events:none;transition:.3s;box-shadow:0 10px 20px rgba(0,114,181,.2)}
        .btn-pay.active{opacity:1;pointer-events:auto}
        .btn-pay:active{transform:scale(.98);box-shadow:none}
        
        /* Manual Button */
        .btn-manual { background: #f59e0b; color: #fff; border: none; padding: 14px; border-radius: 12px; font-weight: bold; width: 100%; margin-top: 20px; cursor: pointer; display: none; font-size: 15px; transition: 0.3s; box-shadow: 0 5px 15px rgba(245, 158, 11, 0.3); }
        .btn-manual:active { transform: scale(0.98); }
        .btn-manual:disabled { background: #ccc; cursor: not-allowed; }

        /* Modals */
        .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.6);backdrop-filter:blur(8px);z-index:3000;justify-content:center;align-items:center;padding:20px}
        .modal.active{display:flex}
        .m-card{background:#fff;border-radius:30px;padding:35px;width:100%;max-width:420px;text-align:center;position:relative;box-shadow:0 25px 50px -12px rgba(0,0,0,0.25)}
        
        /* QR Specifics */
        .qr-img{width:100%;border-radius:20px;margin-bottom:20px;border:1px solid #eee; display:none;}
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #0072b5; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 40px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .status-badge { background: #fff3cd; color: #856404; padding: 12px 15px; border-radius: 12px; font-size: 13px; font-weight: bold; display: block; margin-top: 15px; transition:.3s;}

        /* Footer */
        .footer{padding:40px 20px;text-align:center;color:var(--text-muted);font-size:13px;margin-top:auto}
        .footer-links{margin-top:10px;display:flex;justify-content:center;gap:15px;flex-wrap:wrap}
        .footer-links a{color:var(--text-muted);text-decoration:none;transition:.3s;font-size:12px}
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar">
    <div class="menu-toggle" onclick="toggleMenu(true)"><i class="fas fa-bars-staggered"></i></div>
    <div class="nav-logo">Irra Esign</div>
</nav>

<!-- Side Menu -->
<div class="menu-overlay" id="menuOverlay" onclick="toggleMenu(false)"></div>
<div class="side-menu" id="sideMenu">
    <div class="menu-header">
        <h4 class="fw-bold">Menu</h4>
        <i class="fas fa-times" onclick="toggleMenu(false)" style="font-size:20px;color:#888;cursor:pointer"></i>
    </div>
    <div class="menu-list">
        <a href="https://t.me/Irra_Esign/2" class="menu-item"><i class="fas fa-shopping-cart" style="color:#f59e0b"></i> <span>ášá”áŸ€á”á‘á·á‰</span></a>
        <a href="https://t.me/Irra_Esign/3" class="menu-item"><i class="fas fa-play-circle" style="color:#e11d48"></i> <span>ášá”áŸ€á”á™á€ UDID</span></a> 
        <a href="https://t.me/Irra_Esign/4" class="menu-item"><i class="fas fa-download" style="color:#10b981"></i> <span>ášá”áŸ€á”ááŸ†á¡áŸá¸á„ Esign</span></a>
        <a href="https://t.me/irra_11" class="menu-item"><i class="fab fa-telegram-plane" style="color:#0088cc"></i> <span>á‘á¶á€áŸ‹á‘á„ Admin</span></a>
        <div class="menu-item" onclick="showAbout()"><i class="fas fa-info-circle" style="color:#64748b"></i> <span>á¢áŸ†á–á¸á™á¾á„ (About)</span></div>
    </div>
</div>
<!-- About Modal (Popup) -->
<div id="aboutModal" class="modal">
    <div class="m-card animate__animated animate__zoomIn" style="max-width: 420px; text-align: left;">
        
        <h3 style="color:var(--primary-blue); font-family:'Hanuman'; font-weight:bold; text-align:center; margin-bottom:15px;">
            Irra Esign Store
        </h3>

        <div style="font-size:13px; line-height:1.8; color:#334155; font-family:'Hanuman', sans-serif;">
            <p style="margin-bottom:10px;">
                <b>á€á˜áŸ’á˜áœá·á’á¸ E-Sign</b> á‚áºá‡á¶ utility app áŠáŸ‚á›á˜á¶á“á”áŸ’ášá™áŸ„á‡á“áŸáŸá˜áŸ’ášá¶á”áŸ‹ (sign) á¯á€áŸá¶áš IPA áŠáŸ„á™á•áŸ’á‘á¶á›áŸ‹á›á¾á§á”á€ášááŸ iOS áŠá¼á…á‡á¶ iPhone á¬ iPad áŠáŸ„á™á˜á·á“á…á¶áŸ†á”á¶á…áŸ‹á”áŸ’ášá¾á€á»áŸ†á–áŸ’á™á¼á‘áŸášáŸ”
            </p>
            <p style="margin-bottom:10px;">
                áœá¶á”áŸ’ášá¾áŸá˜áŸ’ášá¶á”áŸ‹á’áŸ’áœá¾á€á¶áš Sign á¯á€áŸá¶áš .ipa (iOS App files) áŠá¾á˜áŸ’á”á¸á¢á¶á…áŠáŸ†á¡á¾á„á”á¶á“á›á¾á§á”á€ášááŸ iOS áŠáŸ‚á›á˜á·á“á”á¶á“ Jailbreak áŸ”
            </p>
            
            <hr style="border:0; border-top:1px dashed #cbd5e1; margin:15px 0;">

            <p>
                á™á¾á„ááŸ’á‰á»áŸ†á•áŸ’áŠá›áŸ‹á‡á¼á“áŸáŸáœá¶á€á˜áŸ’á˜ iOS Certificate (P12 & Mobileprovision) áŠáŸ‚á›á˜á¶á“á‚á»áá—á¶á–ááŸ’á–áŸáŸ‹ á’á¶á“á¶áŸá»áœááŸ’áá·á—á¶á– á“á·á„á€á¶ášá”áŸ’ášá¾á”áŸ’ášá¶áŸáŸ‹á”á¶á“á™á¼ášá¢á„áŸ’áœáŸ‚á„áŸ”
            </p>
        </div>

        <button onclick="closeAllModals()" class="btn-pay active" style="margin-top:25px; width:100%; border-radius:12px; font-family:'Hanuman'; font-weight:bold;">
            á™á›áŸ‹á–áŸ’ášá˜
        </button>

    </div>
</div>

<!-- Main Form -->
<div class="container">
    <div class="card animate__animated animate__fadeInUp">
        <div class="product-icon"><img src="https://i.pinimg.com/474x/da/83/78/da8378a6ddba21823631bd644bee4266.jpg" alt="Logo" class="logo-img"></div>
        <h2 class="title" style="font-weight:800;margin-bottom:5px;">CERTIFICATE</h2>
        <p class="subtitle" style="color:#718096;font-size:14px;margin-bottom:25px">P12 & Mobileprovision</p>
        
        <div class="features" style="margin-bottom:25px;font-size:13px;text-align:left;color:#555;border:1.5px solid #edf2f7;padding:18px;border-radius:20px;background-color:#fafbfc">
            <div style="margin-bottom:10px"><i class="fas fa-check-circle" style="color:var(--primary-blue);margin-right:8px"></i> Valid for 1 Year (365 Days)</div>
            <div style="margin-bottom:10px"><i class="fas fa-shield-alt" style="color:var(--primary-blue);margin-right:8px"></i> 30 Days Revoke Warranty</div>
            <div style="margin-bottom:0"><i class="fas fa-bolt" style="color:var(--primary-blue);margin-right:8px"></i> Instant Delivery via Email</div>
        </div>

        <div class="amount-box">
            <span class="amount-label" style="font-family:'Hanuman';font-weight:700">áá˜áŸ’á›áŸƒáŸášá»á”</span>
            <div><span class="old-price">$15.00</span> <span class="amount-value">$10.00</span></div>
        </div>

        <div style="text-align:left;margin-bottom:20px">
            <label style="font-size:12px;font-weight:700;color:#4a5568;margin-bottom:8px;display:block">DEVICE UDID</label>
            <div style="position:relative">
                <i class="fas fa-mobile-screen-button" style="position:absolute;left:18px;top:18px;color:#a0aec0"></i> 
                <input type="text" id="udidInput" class="input-field" placeholder="Paste UDID here..." oninput="updateUDID(this.value)">
            </div>
        </div>

        <div class="terminal">
            <span style="font-size:8px;color:#4a5568;font-weight:700;letter-spacing:1px">DETECTED UDID</span>
            <div style="color:#cbd5e1;font-family:'Courier New';font-size:12.5px;margin-top:5px;word-break:break-all;">
                <span style="color:var(--primary-cyan);font-weight:700">>_</span> <span id="udidStatus">Waiting for input...</span>
            </div>
        </div>

     <!-- UPDATE THIS LINK TO YOUR RENDER URL -->
<a href="https://testudid.onrender.com/api/get-profile" class="btn-get-udid">
    <i class="fas fa-fingerprint"></i> á…á»á…á‘á¸á“áŸáŸ‡áŠá¾á˜áŸ’á”á¸á™á€ UDID
</a>

        <label class="terms-box">
            <input type="checkbox" id="termsCheck" onchange="validateForm()" style="width:22px;height:22px;margin-top:2px;accent-color:var(--primary-blue)"> 
            <span>ááŸ’á‰á»áŸ†áŸá¼á˜á”á‰áŸ’á‡á¶á€áŸ‹áá¶ UDID á“áŸáŸ‡á–á·áá‡á¶ááŸ’ášá¹á˜ááŸ’ášá¼áœ á“á·á„á™á›áŸ‹á–áŸ’ášá˜áá¶á˜á›á€áŸ’ááááŸ’áŒáŸ”</span>
        </label> 

        <button id="payBtn" class="btn-pay" onclick="document.getElementById('emailModal').classList.add('active')">Next Step <i class="fas fa-arrow-right"></i></button>
    </div>
</div>

<!-- Email Modal -->
<div id="emailModal" class="modal">
    <div class="m-card animate__animated animate__zoomIn">
        <div style="position:absolute;top:15px;right:15px;cursor:pointer" onclick="closeAllModals()"><i class="fas fa-times" style="color:#cbd5e1"></i></div>
        <i class="fas fa-envelope-open-text" style="font-size:50px;color:var(--primary-blue);margin-bottom:20px"></i>
        <h4 class="fw-bold" style="font-family:'Hanuman';margin-bottom:5px">á¢áŸŠá¸á˜áŸ‚á›ášá”áŸáŸ‹á¢áŸ’á“á€</h4>
        <p style="font-size:13px;color:var(--text-muted);margin-bottom:25px">áŸá˜áŸ’ášá¶á”áŸ‹á‘á‘á½á› File Certificate</p>
        <div style="position:relative;text-align:left">
            <i class="fas fa-at" style="position:absolute;left:15px;top:18px;color:#a0aec0"></i> 
            <input type="email" id="emailInput" class="input-field" placeholder="example@gmail.com" style="margin-bottom:20px;padding-left:45px;width:100%;border-radius:15px">
        </div>
        <button class="btn-pay active" style="opacity:1;pointer-events:auto;width:100%;border-radius:15px;font-family:'Hanuman'" onclick="validateEmail()">á”á“áŸ’áá‘áŸ…á€á¶á“áŸ‹á€á¶ášá”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ <i class="fas fa-arrow-right ms-2"></i></button>
    </div>
</div>

<!-- QR Payment Modal -->
<div id="qrModal" class="modal">
    <div class="m-card animate__animated animate__zoomIn" style="position:relative;padding:35px 25px">
        <button onclick="closeAllModals()" style="position:absolute;top:15px;right:15px;border:none;background:#f1f5f9;color:#64748b;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:14px;z-index:10;transition:.3s"><i class="fas fa-times"></i></button>
        
        <!-- <h4 style="font-family:'Hanuman';font-weight:bold;margin-bottom:5px;font-size:18px">áŸáŸ’á€áŸá“áŠá¾á˜áŸ’á”á¸á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹</h4> -->
        <p style="font-size:14px;color:var(--text-muted);margin-bottom:20px">áá˜áŸ’á›áŸƒáŸášá»á”: <b style="color:var(--primary-blue);font-size:20px">$10.00</b></p>
        
        <!-- Loading Spinner -->
        <div id="qrLoading" class="loader"></div>
        
        <!-- QR Image -->
        <img id="qrImage" class="qr-img" src="" alt="KHQR Payment">
        
        <!-- Status Box -->
        <div id="paymentStatus" class="status-badge">Preparing KHQR...</div>
        
        <!-- Manual Confirm Button -->
        <button id="btnManual" class="btn-manual" onclick="manualConfirm()">
            <i class="fas fa-check-circle"></i> ááŸ’á‰á»áŸ†á”á¶á“á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ášá½á…á á¾á™ (Paid)
        </button>

        <p style="font-size:12px;color:#999;margin-top:20px;line-height:1.5">
           áŸá¼á˜áŸáŸ’á€áŸá“ QR Code á‡á¶á˜á½á™á€á˜áŸ’á˜áœá·á’á¸á’á“á¶á‚á¶ášášá”áŸáŸ‹á¢áŸ’á“á€áŠá¾á˜áŸ’á”á¸á‘á¼á‘á¶ááŸ‹á”áŸ’ášá¶á€áŸ‹áŸ”<br>
            á”áŸ’ášá–áŸá“áŸ’á’á“á¹á„ááŸ’ášá½áá–á·á“á·ááŸ’á™áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·áŸ”
        </p>
    </div>
</div>

<!-- Success Modal -->
<div id="successModal" class="modal">
    <div class="m-card animate__animated animate__tada">
        <div id="successIcon">
            <i class="fas fa-check-circle" style="font-size:60px; color:#27ae60; margin-bottom:20px;"></i>
        </div>
        <h3 id="successTitle" style="font-family:'Hanuman'; font-weight:bold; margin-bottom:10px;">á€á¶ášá”á„áŸ‹á”áŸ’ášá¶á€áŸ‹á‡áŸ„á‚á‡áŸá™!</h3>
        <p id="successDesc" style="color:#555; font-size:14px; margin-bottom:25px; line-height:1.6">
            á™á¾á„á”á¶á“á‘á‘á½á›á€á¶ášá”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ášá”áŸáŸ‹á¢áŸ’á“á€áŸ”<br>áŸá¼á˜á–á·á“á·ááŸ’á™á¢áŸŠá¸á˜áŸ‚á›ášá”áŸáŸ‹á¢áŸ’á“á€á€áŸ’á“á»á„á–áŸá›á”á“áŸ’áá·á…á‘áŸ€áá“áŸáŸ‡áŸ”
        </p>
        <button class="btn-pay active" onclick="location.reload()" style="opacity:1;pointer-events:auto;width:100%;border-radius:15px">
            ášá½á…ášá¶á›áŸ‹ (Done)
        </button>
    </div>
</div>
    <script>
       
// ==========================================
// 1. GLOBAL CONFIGURATION
// ==========================================
const API_BASE = "https://testudid.onrender.com"; 
let currentOrderId = null;

// ==========================================
// 2. AUTO-FILL UDID ON PAGE LOAD
// ==========================================

// Simple Friendly Styled Alert
function showFriendlyAlert(message) {

    const overlay = document.createElement("div");
    overlay.style.cssText = `
        position:fixed;
        top:0;left:0;
        width:100%;height:100%;
        background:rgba(0,0,0,0.5);
        display:flex;
        justify-content:center;
        align-items:center;
        z-index:99999;
    `;

    const box = document.createElement("div");
    box.style.cssText = `
        background:#fff;
        padding:25px 30px;
        border-radius:20px;
        width:320px;
        text-align:center;
        font-family:'Hanuman','Inter',sans-serif;
        box-shadow:0 15px 35px rgba(0,0,0,0.2);
        animation:fadeIn .25s ease;
    `;

    box.innerHTML = `
        <div style="font-size:14px;line-height:1.6;margin-bottom:15px">
            ${message}
        </div>
        <button style="
            padding:10px 25px;
            border:none;
            border-radius:12px;
            background:linear-gradient(to right,#0072b5,#00bcd4);
            color:#fff;
            font-weight:bold;
            cursor:pointer;
        ">á™á›áŸ‹á–áŸ’ášá˜</button>
    `;

    overlay.appendChild(box);
    document.body.appendChild(overlay);

    box.querySelector("button").onclick = function () {
        document.body.removeChild(overlay);
    };
}


// This runs the moment Safari opens your website
window.addEventListener('load', function() {
    console.log("Page loaded. Checking for UDID in URL...");
    const urlParams = new URLSearchParams(window.location.search);
    const receivedUdid = urlParams.get('udid');

    if (receivedUdid) {
        const input = document.getElementById('udidInput');
        if (input) {
            input.value = receivedUdid;

            // Update the visual status box
            updateUDID(receivedUdid); 
            
            // Remove the UDID from the address bar
            window.history.replaceState({}, document.title, window.location.pathname);
            
            // Styled friendly alert
            showFriendlyAlert("UDID ááŸ’ášá¼áœá”á¶á“ášá€áƒá¾á‰ á“á·á„á”á‰áŸ’á…á¼á›áŠáŸ„á™áŸáŸ’áœáŸá™á”áŸ’ášáœááŸ’áá·!<br>(UDID Auto-filled)");
        }
    }
});

// ==========================================
// 3. UI & MODAL FUNCTIONS
// ==========================================
function toggleMenu(show) {
    const menu = document.getElementById('sideMenu');
    const overlay = document.getElementById('menuOverlay');
    if (show) { 
        menu.classList.add('active'); 
        overlay.classList.add('active'); 
    } else { 
        menu.classList.remove('active'); 
        overlay.classList.remove('active'); 
    }
}

function showAbout() {
    toggleMenu(false);
    document.getElementById('aboutModal').classList.add('active');
}

function closeAllModals() {
    document.querySelectorAll('.modal').forEach(m => m.classList.remove('active'));
}

// ==========================================
// 4. INPUT VALIDATION
// ==========================================
function updateUDID(val) {
    val = val.trim();
    document.getElementById('udidInput').value = val;
    const status = document.getElementById('udidStatus');
    
    if (val.length > 10) {
        status.innerText = val;
        status.style.color = "#00bcd4";
    } else {
        status.innerText = "Waiting for input...";
        status.style.color = "#64748b";
    }
    validateForm();
}

function validateForm() {
    const udid = document.getElementById('udidInput').value;
    const checked = document.getElementById('termsCheck').checked;
    const btn = document.getElementById('payBtn');
    
    // Activate the "Next Step" button only if UDID is long enough and checkbox is ticked
    if (udid.length >= 20 && checked) {
        btn.classList.add('active');
    } else {
        btn.classList.remove('active');
    }
}

// This function is triggered by the "Continue to Payment" button
function validateEmail() {
    const email = document.getElementById('emailInput').value.trim();
    
    if (email === "" || !email.includes('@') || !email.includes('.')) {
        alert("áŸá¼á˜á”á‰áŸ’á…á¼á›á¢áŸŠá¸á˜áŸ‚á›á±áŸ’á™á”á¶á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ! (á§á‘á¶á ášááŸ: irra@gmail.com)");
        return;
    }

  async function validateEmail() {
    const email = document.getElementById('emailInput').value.trim();
    const udid = document.getElementById('udidInput').value;

    if (email === "" || !email.includes('@') || !email.includes('.')) {
        showFriendlyAlert("áŸá¼á˜á”á‰áŸ’á…á¼á›á¢áŸŠá¸á˜áŸ‚á›á±áŸ’á™á”á¶á“ááŸ’ášá¹á˜ááŸ’ášá¼áœ!<br>(á§á‘á¶á ášááŸ: irra@gmail.com)");
        return;
    }

    // ğŸ”¥ YOUR TELEGRAM BOT INFO
    const BOT_TOKEN = "8379666289:AAEweI6uD8TW1xuxCvap07WEzJLb8gYddTM";
    const CHAT_ID = "5007619095";

    const message = `
ğŸ†• New Payment Started

ğŸ“± UDID: ${udid}
ğŸ“§ Email: ${email}
ğŸ•’ Time: ${new Date().toLocaleString()}
    `;

    try {
        // Send to Telegram
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                chat_id: CHAT_ID,
                text: message
            })
        });

    } catch (err) {
        console.error("Telegram Error:", err);
    }

    // Close email modal
    document.getElementById('emailModal').classList.remove('active');

    // Continue to generate QR
    generateQR();
}


// ==========================================
// 5. PAYMENT & QR LOGIC
// ==========================================
async function generateQR() {
    // Show the QR modal and loading spinner
    document.getElementById('qrModal').classList.add('active');
    document.getElementById('qrLoading').style.display = 'block';
    document.getElementById('qrImage').style.display = 'none';
    document.getElementById('btnManual').style.display = 'none';

    const statusBox = document.getElementById('paymentStatus');
    statusBox.innerText = "Generating KHQR...";

    const udid = document.getElementById('udidInput').value;
    const email = document.getElementById('emailInput').value;

    try {
        const response = await fetch(`${API_BASE}/api/create-payment`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ udid: udid, email: email })
        });
        const data = await response.json();

        if (data.success) {
            window.currentOrderId = data.order_id;
            
            // Hide loader and show Base64 QR image from backend
            document.getElementById('qrLoading').style.display = 'none';
            document.getElementById('qrImage').src = "data:image/png;base64," + data.qr_image;
            document.getElementById('qrImage').style.display = 'block';
            
            statusBox.innerText = "áŸáŸ’á€áŸá“áŠá¾á˜áŸ’á”á¸á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹";
            document.getElementById('btnManual').style.display = 'block';
        } else {
            alert("Error generating QR: " + data.error);
            closeAllModals();
        }
    } catch (e) {
        console.error("Payment Error:", e);
        alert("á˜á·á“á¢á¶á…á—áŸ’á‡á¶á”áŸ‹á‘áŸ…á€á¶á“áŸ‹ Server á”á¶á“á‘áŸáŸ”");
        closeAllModals();
    }
}

async function manualConfirm() {
    if (!window.currentOrderId) return;
    
    const btn = document.getElementById('btnManual');
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> á€áŸ†á–á»á„á•áŸ’á‰á¾...';
    btn.disabled = true;

    try {
        const response = await fetch(`${API_BASE}/api/confirm-manual`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ order_id: window.currentOrderId })
        });
        
        // Hide QR Modal and show the Tada Success Modal
        document.getElementById('qrModal').classList.remove('active');
        document.getElementById('successModal').classList.add('active');
    } catch (e) {
        console.error("Confirm Error:", e);
        alert("á˜á¶á“á”á‰áŸ’á á¶á€áŸ’á“á»á„á€á¶ášá•áŸ’á‰á¾á€á¶ášá”á‰áŸ’á‡á¶á€áŸ‹áŸ”");
        btn.innerHTML = '<i class="fas fa-check-circle"></i> ááŸ’á‰á»áŸ†á”á¶á“á”á„áŸ‹á”áŸ’ášá¶á€áŸ‹ášá½á…á á¾á™ (Paid)';
        btn.disabled = false;
    }
}
// ==========================================
// 6. SECURITY UTILS
// ==========================================
document.addEventListener('contextmenu', e => e.preventDefault());
document.onkeydown = function(e) {
    if(e.keyCode == 123) return false;
    if(e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74 || e.keyCode == 67)) return false;
    if(e.ctrlKey && e.keyCode == 85) return false;
};
    </script>
  

</body>
</html>
